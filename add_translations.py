#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
翻訳ファイルを生成・更新するスクリプト
"""

import os
import xml.etree.ElementTree as ET

# 各言語の翻訳辞書
TRANSLATIONS = {
    'ja': {
        'All Objects List:': 'すべてのオブジェクトリスト:',
        'Angle:': '角度:',
        'Apply Properties': 'プロパティを適用',
        'Cancel': 'キャンセル',
        'Cannot load properties:': 'プロパティを読み込めません:',
        'Display Name': '表示名',
        'Error': 'エラー',
        'Font Size': 'フォントサイズ',
        'Hello': 'こんにちは',
        'Image Path': '画像パス',
        'Import failed': 'インポート失敗',
        'Information': '情報',
        'Item Name': 'アイテム名',
        'Item Properties': 'アイテムプロパティ',
        'Item information has been updated.': 'アイテム情報が更新されました。',
        'Layout Info': 'レイアウト情報',
        'Layout Information:': 'レイアウト情報:',
        'Layout Items:': 'レイアウトアイテム:',
        'Layout List:': 'レイアウトリスト:',
        'Layout Name:': 'レイアウト名:',
        'Layout Selection & Item Management': 'レイアウト選択とアイテム管理',
        'Load Layout': 'レイアウトを読み込み',
        'Open Layout Manager': 'レイアウトマネージャーを開く',
        'Page': 'ページ',
        'Page Count:': 'ページ数:',
        'Page Information:': 'ページ情報:',
        'Please select a layout.': 'レイアウトを選択してください。',
        'Print area moved.': 'プリント領域が移動しました。',
        'Refresh Item Info': 'アイテム情報を更新',
        'Rotation Angle': '回転角度',
        'Save Layout': 'レイアウトを保存',
        'Scale': '縮尺',
        'Scale:': '縮尺:',
        'Selected Item Properties:': '選択したアイテムのプロパティ:',
        'Show Print Area on Map': 'マップにプリント領域を表示',
        'Text': 'テキスト',
        'Total Objects:': 'オブジェクト総数:',
        'Type': 'タイプ',
        'Visible': '表示',
        'Warning': '警告',
        'X Position (mm)': 'X位置（mm）',
        'Y Position (mm)': 'Y位置（mm）',
    },
    'fr': {
        'All Objects List:': 'Liste de tous les objets:',
        'Angle:': 'Angle:',
        'Apply Properties': 'Appliquer les propriétés',
        'Cancel': 'Annuler',
        'Cannot load properties:': 'Impossible de charger les propriétés:',
        'Display Name': 'Nom d\'affichage',
        'Error': 'Erreur',
        'Font Size': 'Taille de police',
        'Hello': 'Bonjour',
        'Image Path': 'Chemin de l\'image',
        'Import failed': 'Échec de l\'importation',
        'Information': 'Information',
        'Item Name': 'Nom de l\'élément',
        'Item Properties': 'Propriétés de l\'élément',
        'Item information has been updated.': 'Les informations sur l\'élément ont été mises à jour.',
        'Layout Info': 'Infos de mise en page',
        'Layout Information:': 'Informations de mise en page:',
        'Layout Items:': 'Éléments de mise en page:',
        'Layout List:': 'Liste des mises en page:',
        'Layout Name:': 'Nom de la mise en page:',
        'Layout Selection & Item Management': 'Sélection de mise en page et gestion des éléments',
        'Load Layout': 'Charger la mise en page',
        'Open Layout Manager': 'Ouvrir le gestionnaire de mise en page',
        'Page': 'Page',
        'Page Count:': 'Nombre de pages:',
        'Page Information:': 'Informations de page:',
        'Please select a layout.': 'Veuillez sélectionner une mise en page.',
        'Print area moved.': 'Zone d\'impression déplacée.',
        'Refresh Item Info': 'Actualiser les infos de l\'élément',
        'Rotation Angle': 'Angle de rotation',
        'Save Layout': 'Enregistrer la mise en page',
        'Scale': 'Échelle',
        'Scale:': 'Échelle:',
        'Selected Item Properties:': 'Propriétés de l\'élément sélectionné:',
        'Show Print Area on Map': 'Afficher la zone d\'impression sur la carte',
        'Text': 'Texte',
        'Total Objects:': 'Nombre total d\'objets:',
        'Type': 'Type',
        'Visible': 'Visible',
        'Warning': 'Avertissement',
        'X Position (mm)': 'Position X (mm)',
        'Y Position (mm)': 'Position Y (mm)',
    },
    'de': {
        'All Objects List:': 'Liste aller Objekte:',
        'Angle:': 'Winkel:',
        'Apply Properties': 'Eigenschaften anwenden',
        'Cancel': 'Abbrechen',
        'Cannot load properties:': 'Eigenschaften konnten nicht geladen werden:',
        'Display Name': 'Anzeigename',
        'Error': 'Fehler',
        'Font Size': 'Schriftgröße',
        'Hello': 'Hallo',
        'Image Path': 'Bildpfad',
        'Import failed': 'Import fehlgeschlagen',
        'Information': 'Information',
        'Item Name': 'Elementname',
        'Item Properties': 'Elementeigenschaften',
        'Item information has been updated.': 'Elementinformationen wurden aktualisiert.',
        'Layout Info': 'Layout-Info',
        'Layout Information:': 'Layout-Informationen:',
        'Layout Items:': 'Layout-Elemente:',
        'Layout List:': 'Layout-Liste:',
        'Layout Name:': 'Layout-Name:',
        'Layout Selection & Item Management': 'Layout-Auswahl und Elementverwaltung',
        'Load Layout': 'Layout laden',
        'Open Layout Manager': 'Layout-Manager öffnen',
        'Page': 'Seite',
        'Page Count:': 'Seitenzahl:',
        'Page Information:': 'Seiteninformationen:',
        'Please select a layout.': 'Bitte wählen Sie ein Layout.',
        'Print area moved.': 'Druckbereich verschoben.',
        'Refresh Item Info': 'Elementinfo aktualisieren',
        'Rotation Angle': 'Rotationswinkel',
        'Save Layout': 'Layout speichern',
        'Scale': 'Maßstab',
        'Scale:': 'Maßstab:',
        'Selected Item Properties:': 'Eigenschaften des ausgewählten Elements:',
        'Show Print Area on Map': 'Druckbereich auf Karte anzeigen',
        'Text': 'Text',
        'Total Objects:': 'Gesamtzahl der Objekte:',
        'Type': 'Typ',
        'Visible': 'Sichtbar',
        'Warning': 'Warnung',
        'X Position (mm)': 'X-Position (mm)',
        'Y Position (mm)': 'Y-Position (mm)',
    },
    'es': {
        'All Objects List:': 'Lista de todos los objetos:',
        'Angle:': 'Ángulo:',
        'Apply Properties': 'Aplicar propiedades',
        'Cancel': 'Cancelar',
        'Cannot load properties:': 'No se pueden cargar las propiedades:',
        'Display Name': 'Nombre para mostrar',
        'Error': 'Error',
        'Font Size': 'Tamaño de fuente',
        'Hello': 'Hola',
        'Image Path': 'Ruta de imagen',
        'Import failed': 'Error en la importación',
        'Information': 'Información',
        'Item Name': 'Nombre del elemento',
        'Item Properties': 'Propiedades del elemento',
        'Item information has been updated.': 'La información del elemento se ha actualizado.',
        'Layout Info': 'Información de diseño',
        'Layout Information:': 'Información de diseño:',
        'Layout Items:': 'Elementos de diseño:',
        'Layout List:': 'Lista de diseños:',
        'Layout Name:': 'Nombre del diseño:',
        'Layout Selection & Item Management': 'Selección de diseño y gestión de elementos',
        'Load Layout': 'Cargar diseño',
        'Open Layout Manager': 'Abrir administrador de diseño',
        'Page': 'Página',
        'Page Count:': 'Número de páginas:',
        'Page Information:': 'Información de página:',
        'Please select a layout.': 'Seleccione un diseño.',
        'Print area moved.': 'Área de impresión movida.',
        'Refresh Item Info': 'Actualizar información del elemento',
        'Rotation Angle': 'Ángulo de rotación',
        'Save Layout': 'Guardar diseño',
        'Scale': 'Escala',
        'Scale:': 'Escala:',
        'Selected Item Properties:': 'Propiedades del elemento seleccionado:',
        'Show Print Area on Map': 'Mostrar área de impresión en el mapa',
        'Text': 'Texto',
        'Total Objects:': 'Número total de objetos:',
        'Type': 'Tipo',
        'Visible': 'Visible',
        'Warning': 'Advertencia',
        'X Position (mm)': 'Posición X (mm)',
        'Y Position (mm)': 'Posición Y (mm)',
    },
    'it': {
        'All Objects List:': 'Elenco di tutti gli oggetti:',
        'Angle:': 'Angolo:',
        'Apply Properties': 'Applica proprietà',
        'Cancel': 'Annulla',
        'Cannot load properties:': 'Impossibile caricare le proprietà:',
        'Display Name': 'Nome visualizzato',
        'Error': 'Errore',
        'Font Size': 'Dimensione carattere',
        'Hello': 'Ciao',
        'Image Path': 'Percorso immagine',
        'Import failed': 'Importazione non riuscita',
        'Information': 'Informazioni',
        'Item Name': 'Nome elemento',
        'Item Properties': 'Proprietà elemento',
        'Item information has been updated.': 'Le informazioni dell\'elemento sono state aggiornate.',
        'Layout Info': 'Info layout',
        'Layout Information:': 'Informazioni layout:',
        'Layout Items:': 'Elementi layout:',
        'Layout List:': 'Elenco layout:',
        'Layout Name:': 'Nome layout:',
        'Layout Selection & Item Management': 'Selezione layout e gestione elementi',
        'Load Layout': 'Carica layout',
        'Open Layout Manager': 'Apri Gestione layout',
        'Page': 'Pagina',
        'Page Count:': 'Numero pagine:',
        'Page Information:': 'Informazioni pagina:',
        'Please select a layout.': 'Selezionare un layout.',
        'Print area moved.': 'Area di stampa spostata.',
        'Refresh Item Info': 'Aggiorna info elemento',
        'Rotation Angle': 'Angolo di rotazione',
        'Save Layout': 'Salva layout',
        'Scale': 'Scala',
        'Scale:': 'Scala:',
        'Selected Item Properties:': 'Proprietà elemento selezionato:',
        'Show Print Area on Map': 'Mostra area di stampa sulla mappa',
        'Text': 'Testo',
        'Total Objects:': 'Numero totale di oggetti:',
        'Type': 'Tipo',
        'Visible': 'Visibile',
        'Warning': 'Avviso',
        'X Position (mm)': 'Posizione X (mm)',
        'Y Position (mm)': 'Posizione Y (mm)',
    },
    'pt': {
        'All Objects List:': 'Lista de todos os objetos:',
        'Angle:': 'Ângulo:',
        'Apply Properties': 'Aplicar propriedades',
        'Cancel': 'Cancelar',
        'Cannot load properties:': 'Não é possível carregar as propriedades:',
        'Display Name': 'Nome para exibição',
        'Error': 'Erro',
        'Font Size': 'Tamanho da fonte',
        'Hello': 'Olá',
        'Image Path': 'Caminho da imagem',
        'Import failed': 'Falha na importação',
        'Information': 'Informação',
        'Item Name': 'Nome do item',
        'Item Properties': 'Propriedades do item',
        'Item information has been updated.': 'As informações do item foram atualizadas.',
        'Layout Info': 'Informações de layout',
        'Layout Information:': 'Informações de layout:',
        'Layout Items:': 'Itens de layout:',
        'Layout List:': 'Lista de layouts:',
        'Layout Name:': 'Nome do layout:',
        'Layout Selection & Item Management': 'Seleção de layout e gerenciamento de itens',
        'Load Layout': 'Carregar layout',
        'Open Layout Manager': 'Abrir gerenciador de layout',
        'Page': 'Página',
        'Page Count:': 'Contagem de páginas:',
        'Page Information:': 'Informações da página:',
        'Please select a layout.': 'Selecione um layout.',
        'Print area moved.': 'Área de impressão movida.',
        'Refresh Item Info': 'Atualizar informações do item',
        'Rotation Angle': 'Ângulo de rotação',
        'Save Layout': 'Salvar layout',
        'Scale': 'Escala',
        'Scale:': 'Escala:',
        'Selected Item Properties:': 'Propriedades do item selecionado:',
        'Show Print Area on Map': 'Mostrar área de impressão no mapa',
        'Text': 'Texto',
        'Total Objects:': 'Total de objetos:',
        'Type': 'Tipo',
        'Visible': 'Visível',
        'Warning': 'Aviso',
        'X Position (mm)': 'Posição X (mm)',
        'Y Position (mm)': 'Posição Y (mm)',
    },
    'zh': {
        'All Objects List:': '所有对象列表:',
        'Angle:': '角度:',
        'Apply Properties': '应用属性',
        'Cancel': '取消',
        'Cannot load properties:': '无法加载属性:',
        'Display Name': '显示名称',
        'Error': '错误',
        'Font Size': '字体大小',
        'Hello': '你好',
        'Image Path': '图像路径',
        'Import failed': '导入失败',
        'Information': '信息',
        'Item Name': '项目名称',
        'Item Properties': '项目属性',
        'Item information has been updated.': '项目信息已更新。',
        'Layout Info': '布局信息',
        'Layout Information:': '布局信息:',
        'Layout Items:': '布局项目:',
        'Layout List:': '布局列表:',
        'Layout Name:': '布局名称:',
        'Layout Selection & Item Management': '布局选择和项目管理',
        'Load Layout': '加载布局',
        'Open Layout Manager': '打开布局管理器',
        'Page': '页面',
        'Page Count:': '页数:',
        'Page Information:': '页面信息:',
        'Please select a layout.': '请选择布局。',
        'Print area moved.': '打印区域已移动。',
        'Refresh Item Info': '刷新项目信息',
        'Rotation Angle': '旋转角度',
        'Save Layout': '保存布局',
        'Scale': '缩放',
        'Scale:': '缩放:',
        'Selected Item Properties:': '所选项目的属性:',
        'Show Print Area on Map': '在地图上显示打印区域',
        'Text': '文本',
        'Total Objects:': '对象总数:',
        'Type': '类型',
        'Visible': '可见',
        'Warning': '警告',
        'X Position (mm)': 'X位置(mm)',
        'Y Position (mm)': 'Y位置(mm)',
    },
    'ru': {
        'All Objects List:': 'Список всех объектов:',
        'Angle:': 'Угол:',
        'Apply Properties': 'Применить свойства',
        'Cancel': 'Отмена',
        'Cannot load properties:': 'Невозможно загрузить свойства:',
        'Display Name': 'Отображаемое имя',
        'Error': 'Ошибка',
        'Font Size': 'Размер шрифта',
        'Hello': 'Привет',
        'Image Path': 'Путь к изображению',
        'Import failed': 'Ошибка импорта',
        'Information': 'Информация',
        'Item Name': 'Имя элемента',
        'Item Properties': 'Свойства элемента',
        'Item information has been updated.': 'Информация об элементе обновлена.',
        'Layout Info': 'Информация о макете',
        'Layout Information:': 'Информация о макете:',
        'Layout Items:': 'Элементы макета:',
        'Layout List:': 'Список макетов:',
        'Layout Name:': 'Имя макета:',
        'Layout Selection & Item Management': 'Выбор макета и управление элементами',
        'Load Layout': 'Загрузить макет',
        'Open Layout Manager': 'Открыть менеджер макетов',
        'Page': 'Страница',
        'Page Count:': 'Количество страниц:',
        'Page Information:': 'Информация о странице:',
        'Please select a layout.': 'Пожалуйста, выберите макет.',
        'Print area moved.': 'Область печати перемещена.',
        'Refresh Item Info': 'Обновить информацию об элементе',
        'Rotation Angle': 'Угол поворота',
        'Save Layout': 'Сохранить макет',
        'Scale': 'Масштаб',
        'Scale:': 'Масштаб:',
        'Selected Item Properties:': 'Свойства выбранного элемента:',
        'Show Print Area on Map': 'Показать область печати на карте',
        'Text': 'Текст',
        'Total Objects:': 'Всего объектов:',
        'Type': 'Тип',
        'Visible': 'Видимый',
        'Warning': 'Предупреждение',
        'X Position (mm)': 'Позиция X (мм)',
        'Y Position (mm)': 'Позиция Y (мм)',
    },
    'hi': {
        'All Objects List:': 'सभी ऑब्जेक्ट्स की सूची:',
        'Angle:': 'कोण:',
        'Apply Properties': 'गुण लागू करें',
        'Cancel': 'रद्द करें',
        'Cannot load properties:': 'गुणों को लोड नहीं कर सकते:',
        'Display Name': 'प्रदर्शन नाम',
        'Error': 'त्रुटि',
        'Font Size': 'फ़ॉन्ट आकार',
        'Hello': 'नमस्ते',
        'Image Path': 'छवि पथ',
        'Import failed': 'आयात विफल',
        'Information': 'जानकारी',
        'Item Name': 'आइटम का नाम',
        'Item Properties': 'आइटम गुण',
        'Item information has been updated.': 'आइटम की जानकारी अपडेट कर दी गई है।',
        'Layout Info': 'लेआउट जानकारी',
        'Layout Information:': 'लेआउट जानकारी:',
        'Layout Items:': 'लेआउट आइटम्स:',
        'Layout List:': 'लेआउट सूची:',
        'Layout Name:': 'लेआउट का नाम:',
        'Layout Selection & Item Management': 'लेआउट चयन और आइटम प्रबंधन',
        'Load Layout': 'लेआउट लोड करें',
        'Open Layout Manager': 'लेआउट प्रबंधक खोलें',
        'Page': 'पृष्ठ',
        'Page Count:': 'पृष्ठ संख्या:',
        'Page Information:': 'पृष्ठ जानकारी:',
        'Please select a layout.': 'कृपया एक लेआउट चुनें।',
        'Print area moved.': 'प्रिंट क्षेत्र स्थानांतरित किया गया।',
        'Refresh Item Info': 'आइटम जानकारी ताज़ा करें',
        'Rotation Angle': 'घूर्णन कोण',
        'Save Layout': 'लेआउट सहेजें',
        'Scale': 'स्केल',
        'Scale:': 'स्केल:',
        'Selected Item Properties:': 'चयनित आइटम के गुण:',
        'Show Print Area on Map': 'मानचित्र पर प्रिंट क्षेत्र दिखाएं',
        'Text': 'पाठ',
        'Total Objects:': 'कुल ऑब्जेक्ट्स:',
        'Type': 'प्रकार',
        'Visible': 'दृश्यमान',
        'Warning': 'चेतावनी',
        'X Position (mm)': 'X स्थिति (मिमी)',
        'Y Position (mm)': 'Y स्थिति (मिमी)',
    },
}

def register_namespace_all(namespace):
    """ElementTree名前空間登録"""
    ET.register_namespace('', namespace)

def update_ts_file(filepath, language_code):
    """TSファイルに翻訳を追加"""
    tree = ET.parse(filepath)
    root = tree.getroot()
    
    translations = TRANSLATIONS.get(language_code, {})
    
    if not translations:
        print(f"警告: {language_code} の翻訳が見つかりません")
        return
    
    context = root.find('.//context')
    if context is None:
        return
    
    for message in context.findall('message'):
        source = message.find('source')
        translation = message.find('translation')
        
        if source is not None and translation is not None:
            source_text = source.text
            if source_text in translations:
                translation.text = translations[source_text]
                translation.set('type', '')  # unfinished 属性を削除
    
    tree.write(filepath, encoding='utf-8', xml_declaration=True)

# 処理実行
i18n_dir = r'C:\github\geo_report\i18n'
os.chdir(i18n_dir)

for lang_code in ['ja', 'fr', 'de', 'es', 'it', 'pt', 'zh', 'ru', 'hi']:
    ts_file = f'geo_report_{lang_code}.ts'
    ts_path = os.path.join(i18n_dir, ts_file)
    
    if os.path.exists(ts_path):
        print(f"更新中: {ts_file}")
        update_ts_file(ts_path, lang_code)
        print(f"✓ {ts_file} を更新しました")
    else:
        print(f"✗ {ts_file} が見つかりません")

print("\n翻訳の追加が完了しました。")
